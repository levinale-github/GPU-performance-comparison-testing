<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Benchmark Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 2rem;
            padding-bottom: 2rem;
            background-color: #f8f9fa;
        }
        .header {
            margin-bottom: 2rem;
            text-align: center;
        }
        .card {
            margin-bottom: 1.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 1.5rem;
        }
        .table-container {
            overflow-x: auto;
        }
        .text-highlight {
            font-weight: bold;
            color: #007bff;
        }
        .vendor-nvidia {
            background-color: rgba(118, 185, 0, 0.1);
        }
        .vendor-amd {
            background-color: rgba(237, 28, 36, 0.1);
        }
        .vendor-intel {
            background-color: rgba(0, 113, 197, 0.1);
        }
        .vendor-apple {
            background-color: rgba(170, 170, 170, 0.1);
        }
        .filter-controls {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: white;
            border-radius: 0.25rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .price-efficiency-metric {
            font-size: 0.85rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>GPU Benchmark Dashboard</h1>
            <p class="lead">Compare performance metrics across various graphics cards</p>
        </div>

        <div class="filter-controls">
            <div class="row">
                <div class="col-md-4 mb-2">
                    <label for="vendor-filter" class="form-label">Vendor</label>
                    <select id="vendor-filter" class="form-select">
                        <option value="all">All Vendors</option>
                        <option value="NVIDIA">NVIDIA</option>
                        <option value="AMD">AMD</option>
                        <option value="Intel">Intel</option>
                        <option value="Apple">Apple</option>
                    </select>
                </div>
                <div class="col-md-4 mb-2">
                    <label for="category-filter" class="form-label">GPU Category</label>
                    <select id="category-filter" class="form-select">
                        <option value="all">All Categories</option>
                        <option value="desktop">Desktop GPUs</option>
                        <option value="integrated">Integrated GPUs</option>
                        <option value="cloud">Cloud GPUs</option>
                    </select>
                </div>
                <div class="col-md-4 mb-2">
                    <label for="metric-select" class="form-label">Compare By</label>
                    <select id="metric-select" class="form-select">
                        <option value="memory_bandwidth">Memory Bandwidth (GB/s)</option>
                        <option value="fp32_performance">FP32 Performance (TFLOPS)</option>
                        <option value="fp16_performance">FP16 Performance (TFLOPS)</option>
                        <option value="fp64_performance">FP64 Performance (TFLOPS)</option>
                        <option value="graphics_score">Graphics Score</option>
                        <option value="ai_inference">AI Inference (img/sec)</option>
                    </select>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-6">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="show-cost-efficiency">
                        <label class="form-check-label" for="show-cost-efficiency">
                            Show cost efficiency (performance per $)
                        </label>
                    </div>
                </div>
                <div class="col-md-6 text-end">
                    <button id="reset-filters" class="btn btn-outline-secondary btn-sm">Reset Filters</button>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h5 id="chart-title">GPU Performance Comparison</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="performance-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Detailed Comparison</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table table-striped table-hover" id="comparison-table">
                                <thead>
                                    <tr>
                                        <th>GPU</th>
                                        <th>Memory</th>
                                        <th>Memory Bandwidth (GB/s)</th>
                                        <th>FP32 (TFLOPS)</th>
                                        <th>FP16 (TFLOPS)</th>
                                        <th>FP64 (TFLOPS)</th>
                                        <th>Graphics Score</th>
                                        <th>AI Inference (img/sec)</th>
                                        <th>Price ($)</th>
                                        <th>Break-even Hours</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Table will be populated with JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5>FP64/FP32 Ratio Comparison</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="fp64-ratio-chart"></canvas>
                        </div>
                        <p class="small text-muted">
                            FP64/FP32 ratio indicates double-precision performance relative to single-precision.
                            Higher ratios are better for scientific computing workloads.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Cloud vs. On-Premise Cost Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="cost-analysis-chart"></canvas>
                        </div>
                        <p class="small text-muted">
                            Break-even hours show how long it takes for a retail GPU purchase to become more 
                            cost-effective than using an equivalent cloud GPU instance.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h5>About This Dashboard</h5>
                    </div>
                    <div class="card-body">
                        <p>
                            This dashboard visualizes data from the GPU Benchmarking & Performance Testing repository.
                            All data is collected from community contributions using standardized benchmarks.
                        </p>
                        <p>
                            <strong>Last Updated:</strong> <span id="last-updated">Loading...</span>
                        </p>
                        <p>
                            <a href="https://github.com/levinale-github/GPU-performance-comparison-testing" class="btn btn-primary" target="_blank">GitHub Repository</a>
                            <a href="https://github.com/levinale-github/GPU-performance-comparison-testing/blob/main/CONTRIBUTING.md" class="btn btn-outline-secondary" target="_blank">Contribute Your Results</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State variables
        let gpuData = [];
        let currentMetric = 'memory_bandwidth';
        let currentVendor = 'all';
        let currentCategory = 'all';
        let showCostEfficiency = false;
        
        // Chart instances
        let performanceChart;
        let fp64RatioChart;
        let costAnalysisChart;
        
        // Fetch and process data
        async function fetchData() {
            try {
                // Update path to work with GitHub Pages
                const response = await fetch('./aggregated_results.json');
                const data = await response.json();
                
                // Update last updated timestamp
                document.getElementById('last-updated').textContent = new Date(data.last_updated).toLocaleString();
                
                // Assign data to global variable
                gpuData = data.gpus;
                
                // Initialize dashboard with data
                initializeDashboard();
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('Error loading GPU data. Please check the console for details.');
            }
        }
        
        // Category determination logic
        function determineCategory(gpu) {
            const name = gpu.name.toLowerCase();
            
            if (name.includes('integrated') || 
                name.includes('igpu') ||
                name.includes('vega') && !name.includes('radeon') ||
                name.includes('iris') ||
                name.includes('uhd') ||
                gpu.memory.toLowerCase().includes('shared')) {
                return 'integrated';
            }
            
            if (name.includes('a100') ||
                name.includes('v100') ||
                name.includes('t4') ||
                name.includes('k80') ||
                name.includes('p100')) {
                return 'cloud';
            }
            
            return 'desktop';
        }
        
        // Filter GPUs based on current selections
        function getFilteredGPUs() {
            return gpuData.filter(gpu => {
                if (currentVendor !== 'all' && gpu.vendor !== currentVendor) {
                    return false;
                }
                
                if (currentCategory !== 'all' && determineCategory(gpu) !== currentCategory) {
                    return false;
                }
                
                return true;
            });
        }
        
        // Update performance chart
        function updatePerformanceChart() {
            const filteredGPUs = getFilteredGPUs();
            
            // Sort GPUs by selected metric
            filteredGPUs.sort((a, b) => {
                const valueA = a[currentMetric] || 0;
                const valueB = b[currentMetric] || 0;
                return valueB - valueA;  // Descending order
            });
            
            // Prepare chart data
            const labels = filteredGPUs.map(gpu => gpu.name);
            
            const metricData = filteredGPUs.map(gpu => gpu[currentMetric] || 0);
            
            const backgroundColors = filteredGPUs.map(gpu => {
                switch(gpu.vendor) {
                    case 'NVIDIA': return 'rgba(118, 185, 0, 0.7)';
                    case 'AMD': return 'rgba(237, 28, 36, 0.7)';
                    case 'Intel': return 'rgba(0, 113, 197, 0.7)';
                    case 'Apple': return 'rgba(170, 170, 170, 0.7)';
                    default: return 'rgba(108, 117, 125, 0.7)';
                }
            });
            
            // Get display name for the metric
            const metricDisplayNames = {
                'memory_bandwidth': 'Memory Bandwidth (GB/s)',
                'fp32_performance': 'FP32 Performance (TFLOPS)',
                'fp16_performance': 'FP16 Performance (TFLOPS)',
                'fp64_performance': 'FP64 Performance (TFLOPS)',
                'graphics_score': 'Graphics Score',
                'ai_inference': 'AI Inference (images/sec)'
            };
            
            // Update chart title
            document.getElementById('chart-title').textContent = 
                `GPU ${metricDisplayNames[currentMetric]} Comparison`;
            
            // Prepare datasets
            const datasets = [{
                label: metricDisplayNames[currentMetric],
                data: metricData,
                backgroundColor: backgroundColors,
                borderColor: backgroundColors.map(color => color.replace('0.7', '1')),
                borderWidth: 1
            }];
            
            // Add cost efficiency if selected
            if (showCostEfficiency) {
                const costEfficiencyData = filteredGPUs.map(gpu => {
                    if (!gpu[currentMetric] || !gpu.retail_price || gpu.retail_price === 0) {
                        return null;
                    }
                    return gpu[currentMetric] / gpu.retail_price;
                });
                
                datasets.push({
                    label: `${metricDisplayNames[currentMetric]} per $`,
                    data: costEfficiencyData,
                    backgroundColor: 'rgba(255, 193, 7, 0.5)',
                    borderColor: 'rgba(255, 193, 7, 1)',
                    borderWidth: 1,
                    type: 'line',
                    yAxisID: 'y1'
                });
            }
            
            // Update or create chart
            if (performanceChart) {
                performanceChart.data.labels = labels;
                performanceChart.data.datasets = datasets;
                performanceChart.options.scales.y1 = showCostEfficiency ? {
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Performance per $'
                    }
                } : {
                    display: false
                };
                performanceChart.update();
            } else {
                const ctx = document.getElementById('performance-chart').getContext('2d');
                performanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: metricDisplayNames[currentMetric]
                                }
                            },
                            y1: {
                                display: showCostEfficiency,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Performance per $'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update the comparison table
        function updateComparisonTable() {
            const filteredGPUs = getFilteredGPUs();
            
            // Sort GPUs by selected metric
            filteredGPUs.sort((a, b) => {
                const valueA = a[currentMetric] || 0;
                const valueB = b[currentMetric] || 0;
                return valueB - valueA;  // Descending order
            });
            
            const tableBody = document.querySelector('#comparison-table tbody');
            tableBody.innerHTML = '';
            
            filteredGPUs.forEach(gpu => {
                const row = document.createElement('tr');
                
                // Add vendor-specific class for styling
                if (gpu.vendor) {
                    row.classList.add(`vendor-${gpu.vendor.toLowerCase()}`);
                }
                
                // Highlight the current metric
                const highlightClass = gpu[currentMetric] ? 'text-highlight' : '';
                
                row.innerHTML = `
                    <td>${gpu.name}</td>
                    <td>${gpu.memory || 'N/A'}</td>
                    <td class="${currentMetric === 'memory_bandwidth' ? highlightClass : ''}">${gpu.memory_bandwidth?.toFixed(1) || 'N/A'}</td>
                    <td class="${currentMetric === 'fp32_performance' ? highlightClass : ''}">${gpu.fp32_performance?.toFixed(2) || 'N/A'}</td>
                    <td class="${currentMetric === 'fp16_performance' ? highlightClass : ''}">${gpu.fp16_performance?.toFixed(2) || 'N/A'}</td>
                    <td class="${currentMetric === 'fp64_performance' ? highlightClass : ''}">${gpu.fp64_performance?.toFixed(2) || 'N/A'}</td>
                    <td class="${currentMetric === 'graphics_score' ? highlightClass : ''}">${gpu.graphics_score || 'N/A'}</td>
                    <td class="${currentMetric === 'ai_inference' ? highlightClass : ''}">${gpu.ai_inference || 'N/A'}</td>
                    <td>${gpu.retail_price ? '$' + gpu.retail_price.toFixed(0) : 'N/A'}</td>
                    <td>${gpu.break_even_hours ? gpu.break_even_hours.toFixed(0) + ' hrs' : 'N/A'}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Update FP64/FP32 ratio chart
        function updateFP64RatioChart() {
            const filteredGPUs = getFilteredGPUs().filter(gpu => gpu.fp64_fp32_ratio);
            
            // Sort by ratio (descending)
            filteredGPUs.sort((a, b) => b.fp64_fp32_ratio - a.fp64_fp32_ratio);
            
            const labels = filteredGPUs.map(gpu => gpu.name);
            const ratios = filteredGPUs.map(gpu => gpu.fp64_fp32_ratio);
            
            const backgroundColors = filteredGPUs.map(gpu => {
                switch(gpu.vendor) {
                    case 'NVIDIA': return 'rgba(118, 185, 0, 0.7)';
                    case 'AMD': return 'rgba(237, 28, 36, 0.7)';
                    case 'Intel': return 'rgba(0, 113, 197, 0.7)';
                    case 'Apple': return 'rgba(170, 170, 170, 0.7)';
                    default: return 'rgba(108, 117, 125, 0.7)';
                }
            });
            
            if (fp64RatioChart) {
                fp64RatioChart.data.labels = labels;
                fp64RatioChart.data.datasets[0].data = ratios;
                fp64RatioChart.data.datasets[0].backgroundColor = backgroundColors;
                fp64RatioChart.update();
            } else {
                const ctx = document.getElementById('fp64-ratio-chart').getContext('2d');
                fp64RatioChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'FP64/FP32 Ratio',
                            data: ratios,
                            backgroundColor: backgroundColors,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Ratio'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update cost analysis chart
        function updateCostAnalysisChart() {
            const filteredGPUs = getFilteredGPUs().filter(gpu => 
                gpu.retail_price && gpu.cloud_cost_per_hour && gpu.break_even_hours);
            
            // Sort by break-even hours (ascending)
            filteredGPUs.sort((a, b) => a.break_even_hours - b.break_even_hours);
            
            const labels = filteredGPUs.map(gpu => gpu.name);
            const breakEvenHours = filteredGPUs.map(gpu => gpu.break_even_hours);
            const costPerHour = filteredGPUs.map(gpu => gpu.cloud_cost_per_hour);
            
            if (costAnalysisChart) {
                costAnalysisChart.data.labels = labels;
                costAnalysisChart.data.datasets[0].data = breakEvenHours;
                costAnalysisChart.data.datasets[1].data = costPerHour;
                costAnalysisChart.update();
            } else {
                const ctx = document.getElementById('cost-analysis-chart').getContext('2d');
                costAnalysisChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Break-even Hours',
                                data: breakEvenHours,
                                backgroundColor: 'rgba(13, 110, 253, 0.7)',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Cloud Cost per Hour ($)',
                                data: costPerHour,
                                backgroundColor: 'rgba(25, 135, 84, 0.7)',
                                borderWidth: 1,
                                type: 'line',
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Hours to Break Even'
                                }
                            },
                            y1: {
                                position: 'right',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Cost per Hour ($)'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update all charts and tables
        function updateDashboard() {
            updatePerformanceChart();
            updateComparisonTable();
            updateFP64RatioChart();
            updateCostAnalysisChart();
        }
        
        // Set up event handlers
        function setupEventHandlers() {
            document.getElementById('metric-select').addEventListener('change', function() {
                currentMetric = this.value;
                updateDashboard();
            });
            
            document.getElementById('vendor-filter').addEventListener('change', function() {
                currentVendor = this.value;
                updateDashboard();
            });
            
            document.getElementById('category-filter').addEventListener('change', function() {
                currentCategory = this.value;
                updateDashboard();
            });
            
            document.getElementById('show-cost-efficiency').addEventListener('change', function() {
                showCostEfficiency = this.checked;
                updateDashboard();
            });
            
            document.getElementById('reset-filters').addEventListener('click', function() {
                document.getElementById('vendor-filter').value = 'all';
                document.getElementById('category-filter').value = 'all';
                document.getElementById('metric-select').value = 'memory_bandwidth';
                document.getElementById('show-cost-efficiency').checked = false;
                
                currentVendor = 'all';
                currentCategory = 'all';
                currentMetric = 'memory_bandwidth';
                showCostEfficiency = false;
                
                updateDashboard();
            });
        }
        
        // Initialize dashboard
        function initializeDashboard() {
            setupEventHandlers();
            updateDashboard();
        }
        
        // Start everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', fetchData);
    </script>
</body>
</html> 